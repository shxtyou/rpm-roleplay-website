<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход в систему - RPM SMI</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body class="dark-theme">
    <header class="newspaper-header">
        <div class="container">
            <div class="header-top">
                <div class="header-info">
                    <span class="date" id="current-date"></span>
                    <span class="weather">Онлайн: <span id="online-count">0</span> игроков</span>
                </div>
                <div class="header-actions">
                    <a href="index.html" class="auth-btn secondary">На главную</a>
                    <button class="theme-toggle" onclick="toggleTheme()">☀️</button>
                </div>
            </div>
            
            <div class="header-main">
                <div class="logo">
                    <h1 class="newspaper-title">RPM SMI</h1>
                    <p class="newspaper-slogan">Официальные новости штата | Средства Массовой Информации</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="openAuthTab('login')">Вход</button>
                <button class="auth-tab" onclick="openAuthTab('register')">Регистрация</button>
            </div>

            <!-- Форма входа -->
            <div id="login-form" class="auth-form active">
                <h2>Вход в систему</h2>
                <p class="auth-description">Войдите в свою учетную запись редакции</p>
                
                <div class="form-group">
                    <label for="login-email">Email или логин</label>
                    <input type="text" id="login-email" placeholder="Введите email или логин">
                </div>

                <div class="form-group">
                    <label for="login-password">Пароль</label>
                    <input type="password" id="login-password" placeholder="Введите пароль">
                </div>

                <button onclick="attemptLogin()" class="btn btn-primary btn-full">Войти в систему</button>
                
                <div id="login-message" class="auth-message"></div>

                <div class="auth-links">
                    <p>Демо доступы:</p>
                    <div class="demo-accounts">
                        <div class="demo-account" onclick="fillDemoAccount('admin')">
                            <strong>Главный редактор</strong><br>
                            admin / admin2024
                        </div>
                        <div class="demo-account" onclick="fillDemoAccount('editor')">
                            <strong>Редактор</strong><br>
                            editor / editor2024
                        </div>
                        <div class="demo-account" onclick="fillDemoAccount('journalist')">
                            <strong>Журналист</strong><br>
                            journalist / journalist2024
                        </div>
                    </div>
                </div>
            </div>

            <!-- Форма регистрации -->
            <div id="register-form" class="auth-form">
                <h2>Регистрация</h2>
                <p class="auth-description">Создайте учетную запись журналиста</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="reg-username">Логин</label>
                        <input type="text" id="reg-username" placeholder="Придумайте логин">
                    </div>
                    <div class="form-group">
                        <label for="reg-displayname">Отображаемое имя</label>
                        <input type="text" id="reg-displayname" placeholder="Как вас будут видеть читатели">
                    </div>
                </div>

                <div class="form-group">
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" placeholder="Введите ваш email">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="reg-password">Пароль</label>
                        <input type="password" id="reg-password" placeholder="Придумайте пароль">
                    </div>
                    <div class="form-group">
                        <label for="reg-password2">Подтверждение пароля</label>
                        <input type="password" id="reg-password2" placeholder="Повторите пароль">
                    </div>
                </div>

                <div class="form-group">
                    <label for="reg-faction">Фракция (опционально)</label>
                    <select id="reg-faction">
                        <option value="">Не указана</option>
                        <option value="Мэрия">Мэрия</option>
                        <option value="СМИ">СМИ</option>
                        <option value="ЦПД">ЦПД</option>
                        <option value="FBI">FBI</option>
                        <option value="Армия">Армия</option>
                        <option value="Университет">Университет</option>
                        <option value="Crips">Crips</option>
                        <option value="Southside Serpents">Southside Serpents</option>
                        <option value="Русская мафия">Русская мафия</option>
                    </select>
                </div>

                <button onclick="attemptRegister()" class="btn btn-primary btn-full">Зарегистрироваться</button>
                
                <div id="register-message" class="auth-message"></div>

                <div class="auth-notice">
                    <p>После регистрации ваш аккаунт будет ожидать активации редактором.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="newspaper-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>RPM SMI</h4>
                    <p>Официальные новости штата</p>
                </div>
                <div class="footer-section">
                    <h4>Помощь</h4>
                    <a href="contact.html">Техническая поддержка</a>
                    <a href="about.html">О редакции</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 RPM SMI. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Функции для страницы входа
        function openAuthTab(tabName) {
            // Скрываем все формы
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // Убираем активный класс у всех кнопок
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показываем выбранную форму
            document.getElementById(tabName + '-form').classList.add('active');
            
            // Активируем кнопку
            event.target.classList.add('active');
        }

        function attemptLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const messageElement = document.getElementById('login-message');

            if (!email || !password) {
                showMessage(messageElement, 'Заполните все поля', 'error');
                return;
            }

            const result = login(email, password);
            
            if (result.success) {
                showMessage(messageElement, 'Успешный вход! Перенаправление...', 'success');
                setTimeout(() => {
                    window.location.href = 'admin.html';
                }, 1000);
            } else {
                showMessage(messageElement, result.error, 'error');
            }
        }

        function attemptRegister() {
            const username = document.getElementById('reg-username').value;
            const displayName = document.getElementById('reg-displayname').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const password2 = document.getElementById('reg-password2').value;
            const faction = document.getElementById('reg-faction').value;
            const messageElement = document.getElementById('register-message');

            // Валидация
            if (!username || !displayName || !email || !password || !password2) {
                showMessage(messageElement, 'Заполните все обязательные поля', 'error');
                return;
            }

            if (password !== password2) {
                showMessage(messageElement, 'Пароли не совпадают', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage(messageElement, 'Пароль должен содержать минимум 6 символов', 'error');
                return;
            }

            const userData = {
                username: username,
                displayName: displayName,
                email: email,
                password: password,
                faction: faction
            };

            const result = register(userData);
            
            if (result.success) {
                showMessage(messageElement, result.message, 'success');
                document.getElementById('register-form').reset();
                setTimeout(() => {
                    openAuthTab('login');
                }, 2000);
            } else {
                showMessage(messageElement, result.error, 'error');
            }
        }

        function fillDemoAccount(role) {
            const accounts = {
                'admin': { email: 'admin', password: 'admin2024' },
                'editor': { email: 'editor', password: 'editor2024' },
                'journalist': { email: 'journalist', password: 'journalist2024' }
            };

            const account = accounts[role];
            if (account) {
                document.getElementById('login-email').value = account.email;
                document.getElementById('login-password').value = account.password;
            }
        }

        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = 'auth-message ' + type;
            element.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }

        // Перенаправление если уже авторизован
        document.addEventListener('DOMContentLoaded', () => {
            if (authSystem.currentUser) {
                window.location.href = 'admin.html';
            }
        });
    </script>
</body>
</html>